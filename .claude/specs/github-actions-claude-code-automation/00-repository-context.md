# ä»“åº“ä¸Šä¸‹æ–‡åˆ†ææŠ¥å‘Š

## ğŸ“‹ é¡¹ç›®æ¦‚è¿°

### é¡¹ç›®ç±»å‹
**NestJS åç«¯ API åº”ç”¨** - åŸºäºç°ä»£åŒ–æŠ€æœ¯æ ˆçš„å…¨æ ˆåç«¯è„šæ‰‹æ¶

### é¡¹ç›®ç›®çš„
æä¾›ä¸€ä¸ªç”Ÿäº§å°±ç»ªçš„ NestJS åç«¯æ¶æ„æ¨¡æ¿,é›†æˆ Prisma ORMã€PostgreSQL æ•°æ®åº“ã€Redis ç¼“å­˜å’Œå®Œæ•´çš„å¼€å‘å·¥å…·é“¾ã€‚

### æ ¸å¿ƒç‰¹æ€§
- ğŸ—ï¸ æ¨¡å—åŒ–æ¶æ„è®¾è®¡
- ğŸ—„ï¸ ç±»å‹å®‰å…¨çš„æ•°æ®åº“è®¿é—® (Prisma)
- âš¡ Redis ç¼“å­˜é›†æˆ (Cache-Aside æ¨¡å¼)
- ğŸ“š è‡ªåŠ¨ç”Ÿæˆçš„ API æ–‡æ¡£ (Swagger)
- âœ… å…¨å±€è¯·æ±‚éªŒè¯å’Œè½¬æ¢
- ğŸ› ï¸ ç»Ÿä¸€çš„ DX CLI å·¥å…·
- ğŸŒ å¤šç¯å¢ƒé…ç½®ç®¡ç†

---

## ğŸ—ï¸ é¡¹ç›®ç»“æ„

```
aiaction/
â”œâ”€â”€ .claude/                        # Claude Code é…ç½®
â”‚   â”œâ”€â”€ agents/                     # è‡ªå®šä¹‰ Agent é…ç½®
â”‚   â”œâ”€â”€ commands/                   # è‡ªå®šä¹‰å‘½ä»¤
â”‚   â””â”€â”€ specs/                      # é¡¹ç›®è§„èŒƒæ–‡æ¡£
â”œâ”€â”€ .github/                        # GitHub é…ç½®
â”‚   â””â”€â”€ ISSUE_TEMPLATE/
â”‚       â””â”€â”€ ccai-implementation.md  # Claude Code AI è‡ªåŠ¨åŒ–ç³»ç»Ÿå®æ–½è®¡åˆ’
â”œâ”€â”€ doc/                            # é¡¹ç›®æ–‡æ¡£
â”‚   â”œâ”€â”€ ENV_QUICK_REFERENCE.md      # ç¯å¢ƒå˜é‡å¿«é€Ÿå‚è€ƒ
â”‚   â”œâ”€â”€ ENV_UPDATE_SUMMARY.md       # ç¯å¢ƒå˜é‡æ›´æ–°æ‘˜è¦
â”‚   â””â”€â”€ env-structure-design.md     # ç¯å¢ƒç»“æ„è®¾è®¡æ–‡æ¡£
â”œâ”€â”€ e2e/                            # E2E æµ‹è¯•
â”‚   â”œâ”€â”€ config.e2e-spec.ts          # é…ç½®æµ‹è¯•
â”‚   â”œâ”€â”€ database.e2e-spec.ts        # æ•°æ®åº“æµ‹è¯•
â”‚   â”œâ”€â”€ redis.e2e-spec.ts           # Redis æµ‹è¯•
â”‚   â””â”€â”€ jest-e2e.json               # E2E Jest é…ç½®
â”œâ”€â”€ prisma/                         # Prisma ORM é…ç½®
â”‚   â””â”€â”€ schema.prisma               # æ•°æ®æ¨¡å‹å®šä¹‰
â”œâ”€â”€ scripts/                        # å¼€å‘è„šæœ¬
â”‚   â”œâ”€â”€ config/                     # CLI é…ç½®æ–‡ä»¶
â”‚   â”œâ”€â”€ lib/                        # CLI åº“æ–‡ä»¶
â”‚   â”œâ”€â”€ dx                          # ç»Ÿä¸€ DX CLI å·¥å…· (å¯æ‰§è¡Œ)
â”‚   â”œâ”€â”€ setup-env.sh                # ç¯å¢ƒè®¾ç½®è„šæœ¬
â”‚   â”œâ”€â”€ check-services.sh           # æœåŠ¡æ£€æŸ¥è„šæœ¬
â”‚   â””â”€â”€ validate-env.js             # ç¯å¢ƒå˜é‡éªŒè¯è„šæœ¬
â”œâ”€â”€ src/                            # æºä»£ç ç›®å½•
â”‚   â”œâ”€â”€ common/                     # é€šç”¨æ¨¡å—
â”‚   â”‚   â”œâ”€â”€ dto/                    # é€šç”¨ DTO
â”‚   â”‚   â”œâ”€â”€ filters/                # å¼‚å¸¸è¿‡æ»¤å™¨
â”‚   â”‚   â””â”€â”€ interceptors/           # æ‹¦æˆªå™¨
â”‚   â”œâ”€â”€ config/                     # é…ç½®æ¨¡å—
â”‚   â”‚   â””â”€â”€ configuration.ts        # åº”ç”¨é…ç½®å®šä¹‰
â”‚   â”œâ”€â”€ modules/                    # ä¸šåŠ¡æ¨¡å—
â”‚   â”‚   â””â”€â”€ users/                  # ç”¨æˆ·æ¨¡å— (ç¤ºä¾‹)
â”‚   â”‚       â”œâ”€â”€ dto/
â”‚   â”‚       â”œâ”€â”€ users.controller.ts
â”‚   â”‚       â”œâ”€â”€ users.service.ts
â”‚   â”‚       â””â”€â”€ users.module.ts
â”‚   â”œâ”€â”€ prisma/                     # Prisma æœåŠ¡
â”‚   â”‚   â”œâ”€â”€ prisma.module.ts        # å…¨å±€ Prisma æ¨¡å—
â”‚   â”‚   â””â”€â”€ prisma.service.ts       # Prisma æœåŠ¡
â”‚   â”œâ”€â”€ redis/                      # Redis æœåŠ¡
â”‚   â”‚   â”œâ”€â”€ redis.module.ts         # å…¨å±€ Redis æ¨¡å—
â”‚   â”‚   â””â”€â”€ redis.service.ts        # Redis æœåŠ¡
â”‚   â”œâ”€â”€ app.module.ts               # æ ¹æ¨¡å—
â”‚   â”œâ”€â”€ app.controller.ts           # æ ¹æ§åˆ¶å™¨
â”‚   â”œâ”€â”€ app.service.ts              # æ ¹æœåŠ¡
â”‚   â””â”€â”€ main.ts                     # åº”ç”¨å…¥å£
â”œâ”€â”€ .env.development                # å¼€å‘ç¯å¢ƒé…ç½® (é»˜è®¤å€¼,å·²æäº¤)
â”œâ”€â”€ .env.development.local          # æœ¬åœ°å¼€å‘é…ç½® (åŒ…å«æ•æ„Ÿä¿¡æ¯,å·²å¿½ç•¥)
â”œâ”€â”€ .env.production                 # ç”Ÿäº§ç¯å¢ƒæ¨¡æ¿ (å·²æäº¤)
â”œâ”€â”€ .env.test                       # æµ‹è¯•ç¯å¢ƒé…ç½® (å·²æäº¤)
â”œâ”€â”€ .env.e2e                        # E2E æµ‹è¯•é…ç½® (å·²æäº¤)
â”œâ”€â”€ .env.example                    # ç¯å¢ƒå˜é‡æ¨¡æ¿
â”œâ”€â”€ .gitignore                      # Git å¿½ç•¥è§„åˆ™
â”œâ”€â”€ .prettierrc                     # Prettier é…ç½®
â”œâ”€â”€ package.json                    # é¡¹ç›®ä¾èµ–
â”œâ”€â”€ tsconfig.json                   # TypeScript é…ç½®
â”œâ”€â”€ nest-cli.json                   # NestJS CLI é…ç½®
â”œâ”€â”€ CHANGELOG.md                    # å˜æ›´æ—¥å¿—
â”œâ”€â”€ CLAUDE.md                       # Claude Code é¡¹ç›®æŒ‡å—
â”œâ”€â”€ README.md                       # é¡¹ç›®è¯´æ˜æ–‡æ¡£
â””â”€â”€ NPM_SCRIPTS.md                  # npm scripts ä½¿ç”¨è§„èŒƒ
```

### æ–‡ä»¶æ•°é‡ç»Ÿè®¡
- **TypeScript æºæ–‡ä»¶**: 14 ä¸ª
- **æ€»ä»£ç è¡Œæ•°**: 539 è¡Œ (ä¸å«æ³¨é‡Šå’Œç©ºè¡Œ)
- **æµ‹è¯•æ–‡ä»¶**: 3 ä¸ª E2E æµ‹è¯•

---

## ğŸ”§ æŠ€æœ¯æ ˆæ€»ç»“

### æ ¸å¿ƒæ¡†æ¶å’Œè¯­è¨€
- **NestJS**: 10.3.10 - æ¸è¿›å¼ Node.js æ¡†æ¶
- **TypeScript**: 5.5.4 - ç±»å‹å®‰å…¨
- **Node.js**: è¿è¡Œæ—¶ç¯å¢ƒ
- **ES Modules**: é¡¹ç›®ä½¿ç”¨ ESM (`"type": "module"`)

### æ•°æ®å±‚
- **Prisma**: 5.18.0 - ç°ä»£åŒ– ORM
- **@prisma/client**: 5.18.0 - Prisma Client
- **PostgreSQL**: å…³ç³»å‹æ•°æ®åº“ (é€šè¿‡ Prisma è®¿é—®)

### ç¼“å­˜å’Œä¼šè¯
- **Redis**: 4.7.0 - å†…å­˜æ•°æ®åº“
- **cache-manager**: 5.7.6 - ç¼“å­˜æŠ½è±¡å±‚
- **cache-manager-redis-yet**: 5.1.3 - Redis ç¼“å­˜é€‚é…å™¨

### API å’Œæ–‡æ¡£
- **@nestjs/swagger**: 7.4.0 - OpenAPI/Swagger æ–‡æ¡£ç”Ÿæˆ
- **@nestjs/platform-express**: 10.3.10 - Express é€‚é…å™¨

### éªŒè¯å’Œè½¬æ¢
- **class-validator**: 0.14.1 - è£…é¥°å™¨éªŒè¯
- **class-transformer**: 0.5.1 - å¯¹è±¡è½¬æ¢

### é…ç½®ç®¡ç†
- **@nestjs/config**: 3.2.3 - ç¯å¢ƒå˜é‡å’Œé…ç½®ç®¡ç†
- æ”¯æŒå¤šç¯å¢ƒé…ç½®æ–‡ä»¶ (`.env.{NODE_ENV}`, `.env.{NODE_ENV}.local`)

### å¼€å‘å·¥å…·
- **Jest**: 29.7.0 - æµ‹è¯•æ¡†æ¶
- **ts-jest**: 29.2.3 - TypeScript Jest è½¬æ¢å™¨
- **Prettier**: 3.3.3 - ä»£ç æ ¼å¼åŒ–
- **ESLint**: 8.57.0 - ä»£ç æ£€æŸ¥ (é…ç½®å·²ç§»é™¤,ä½†ä¾èµ–ä¿ç•™)
- **supertest**: 7.0.0 - HTTP æµ‹è¯•

### åŒ…ç®¡ç†
- **npm** - é»˜è®¤åŒ…ç®¡ç†å™¨
- æ”¯æŒ pnpm (åœ¨ GitHub Actions è®¡åˆ’ä¸­æåŠ)

---

## ğŸ“ ä»£ç ç»„ç»‡æ¨¡å¼

### æ¶æ„æ¨¡å¼
**åˆ†å±‚æ¨¡å—åŒ–æ¶æ„** - éµå¾ª NestJS å®˜æ–¹æœ€ä½³å®è·µ

```
Module â†’ Controller â†’ Service â†’ Repository (Prisma)
                â†“
             DTO (Validation)
```

### å…¨å±€æœåŠ¡æ¨¡å¼
- `PrismaService` å’Œ `RedisService` é…ç½®ä¸º**å…¨å±€æ¨¡å—** (`@Global()` è£…é¥°å™¨)
- åœ¨ä»»ä½•æ¨¡å—ä¸­æ— éœ€æ˜¾å¼å¯¼å…¥å³å¯æ³¨å…¥ä½¿ç”¨
- éµå¾ª **DRY åŸåˆ™** (Don't Repeat Yourself)

### æ¨¡å—ç»“æ„çº¦å®š
æ¯ä¸ªä¸šåŠ¡æ¨¡å—éµå¾ªç»Ÿä¸€ç»“æ„:
```
modules/<feature>/
â”œâ”€â”€ dto/
â”‚   â”œâ”€â”€ create-<feature>.dto.ts
â”‚   â””â”€â”€ update-<feature>.dto.ts
â”œâ”€â”€ <feature>.controller.ts      # API è·¯ç”±å’Œè¯·æ±‚å¤„ç†
â”œâ”€â”€ <feature>.service.ts          # ä¸šåŠ¡é€»è¾‘
â””â”€â”€ <feature>.module.ts           # æ¨¡å—å®šä¹‰
```

### ç¼“å­˜ç­–ç•¥æ¨¡å¼
**Cache-Aside Pattern** (æ‰‹åŠ¨ç¼“å­˜å¤±æ•ˆ)

```typescript
// è¯»å–æµç¨‹
1. æ£€æŸ¥ Redis ç¼“å­˜
2. ç¼“å­˜å‘½ä¸­ â†’ è¿”å›ç¼“å­˜æ•°æ®
3. ç¼“å­˜æœªå‘½ä¸­ â†’ æŸ¥è¯¢æ•°æ®åº“ â†’ å†™å…¥ç¼“å­˜ â†’ è¿”å›æ•°æ®

// å†™å…¥æµç¨‹
1. æ›´æ–°æ•°æ®åº“
2. åˆ é™¤ç›¸å…³ç¼“å­˜é”® (é›†åˆç¼“å­˜ + å®ä½“ç¼“å­˜)
```

**ç¼“å­˜é”®å‘½åè§„èŒƒ**:
- é›†åˆ: `users:all`
- å•å®ä½“: `user:${id}`
- TTL: 5 åˆ†é’Ÿ (300 ç§’)

### è·¯å¾„åˆ«å
- `@/*` â†’ `src/*` (åœ¨ `tsconfig.json` ä¸­é…ç½®)
- ç¤ºä¾‹: `import { PrismaService } from '@/prisma/prisma.service'`

### æ•°æ®éªŒè¯å’Œè½¬æ¢
å…¨å±€éªŒè¯ç®¡é“é…ç½® (`src/main.ts:25-31`):
```typescript
new ValidationPipe({
  whitelist: true,              // åˆ é™¤éç™½åå•å±æ€§
  transform: true,              // è‡ªåŠ¨è½¬æ¢ä¸º DTO å®ä¾‹
  forbidNonWhitelisted: true,   // æ‹’ç»åŒ…å«é¢å¤–å±æ€§çš„è¯·æ±‚
})
```

---

## ğŸ¨ ç¼–ç è§„èŒƒå’Œçº¦å®š

### TypeScript é…ç½®
- **Target**: ES2021
- **Module**: CommonJS (æ„å»ºäº§ç‰©)
- **Strict Checks**: éƒ¨åˆ†ç¦ç”¨ (`strictNullChecks: false`, `noImplicitAny: false`)
- **Decorators**: å¯ç”¨å®éªŒæ€§è£…é¥°å™¨
- **Source Maps**: å·²å¯ç”¨

### ä»£ç é£æ ¼ (Prettier)
```json
{
  "singleQuote": true,          // å•å¼•å·
  "trailingComma": "all",       // å°¾éšé€—å·
  "printWidth": 100              // è¡Œå®½ 100 å­—ç¬¦
}
```

### å‘½åçº¦å®š
- **æ–‡ä»¶å**: kebab-case (ä¾‹: `users.service.ts`)
- **ç±»å**: PascalCase (ä¾‹: `UsersService`)
- **æ¥å£/ç±»å‹**: PascalCase, å‰ç¼€ `I` å¯é€‰
- **å¸¸é‡**: UPPER_SNAKE_CASE (ä¾‹: `DATABASE_URL`)
- **å˜é‡/å‡½æ•°**: camelCase

### æ•°æ®åº“çº¦å®š (Prisma)
- **ä¸»é”®**: UUID (`@default(uuid())`)
- **æ—¶é—´æˆ³**: è‡ªåŠ¨ç®¡ç† (`createdAt`, `updatedAt`)
- **è¡¨åæ˜ å°„**: ä½¿ç”¨ `@@map()` å°† PascalCase æ¨¡å‹æ˜ å°„åˆ° snake_case è¡¨å
  - æ¨¡å‹: `User` â†’ è¡¨: `users`
  - æ¨¡å‹: `Post` â†’ è¡¨: `posts`

### API è®¾è®¡çº¦å®š
- **RESTful è·¯ç”±**: `/users`, `/users/:id`
- **HTTP çŠ¶æ€ç **:
  - 200: æˆåŠŸ
  - 201: åˆ›å»ºæˆåŠŸ
  - 204: åˆ é™¤æˆåŠŸ (æ— å†…å®¹)
  - 404: èµ„æºä¸å­˜åœ¨
  - 409: å†²çª (å¦‚é‚®ç®±å·²å­˜åœ¨)
- **Swagger æ–‡æ¡£**: æ¯ä¸ªç«¯ç‚¹å¿…é¡»åŒ…å« `@ApiOperation`, `@ApiResponse` è£…é¥°å™¨

### SOLID åŸåˆ™åº”ç”¨
- **å•ä¸€èŒè´£ (SRP)**: æ¯ä¸ªæœåŠ¡åªå¤„ç†ä¸€ä¸ªé¢†åŸŸ
- **ä¾èµ–åè½¬ (DIP)**: é€šè¿‡æ„é€ å‡½æ•°æ³¨å…¥ä¾èµ–
- **å¼€é—­åŸåˆ™ (OCP)**: é€šè¿‡æ¨¡å—åŒ–è®¾è®¡æ”¯æŒæ‰©å±•

---

## ğŸ“š æ–‡æ¡£å’Œè§„èŒƒ

### é¡¹ç›®æ–‡æ¡£
1. **README.md** - é¡¹ç›®æ¦‚è§ˆã€å¿«é€Ÿå¼€å§‹ã€API æ–‡æ¡£
2. **CLAUDE.md** - Claude Code ä¸“ç”¨æŒ‡å— (æ¶æ„ã€å‘½ä»¤ã€å¼€å‘åŸåˆ™)
3. **CHANGELOG.md** - ç‰ˆæœ¬å†å²å’Œå˜æ›´è®°å½•
4. **NPM_SCRIPTS.md** - npm scripts ä½¿ç”¨è§„èŒƒ
5. **doc/env-structure-design.md** - ç¯å¢ƒå˜é‡ç®¡ç†è¯¦ç»†è®¾è®¡

### API æ–‡æ¡£
- **è‡ªåŠ¨ç”Ÿæˆ**: Swagger UI (è¿è¡Œæ—¶è®¿é—® `http://localhost:3000/api`)
- **è£…é¥°å™¨é©±åŠ¨**: ä½¿ç”¨ `@nestjs/swagger` è£…é¥°å™¨
- **ç¤ºä¾‹æ•°æ®**: æ¯ä¸ª DTO åŒ…å« `@ApiProperty` ç¤ºä¾‹

### è´¡çŒ®æŒ‡å—
- æš‚æ—  `CONTRIBUTING.md`
- ä»£ç è§„èŒƒé€šè¿‡ Prettier å’Œ (å·²ç§»é™¤çš„) ESLint å¼ºåˆ¶æ‰§è¡Œ

---

## ğŸ”„ å¼€å‘å·¥ä½œæµ

### Git å·¥ä½œæµ
**ä¸»åˆ†æ”¯ç­–ç•¥** (åŸºäº Git çŠ¶æ€):
- **ä¸»åˆ†æ”¯**: `main`
- **åŠŸèƒ½åˆ†æ”¯**: æœªæ˜ç¡®å®šä¹‰å‘½åè§„èŒƒ
- **æœ€è¿‘æäº¤** (æœ€æ–° 5 æ¡):
  ```
  9b93e81 - refactor: improve environment variable handling and documentation
  a33c6b4 - chore: remove ESLint configuration and enhance documentation for DX CLI
  acb97e9 - refactor: update package.json scripts and remove obsolete E2E tests
  58e71ff - feat: enhance environment configuration and documentation
  3406c87 - feat: åˆå§‹åŒ– NestJS + Prisma + PostgreSQL + Redis åç«¯è„šæ‰‹æ¶
  ```
- **æäº¤è§„èŒƒ**: ä½¿ç”¨ Conventional Commits (feat:, chore:, refactor:)

### CI/CD é…ç½®
**å½“å‰çŠ¶æ€**: æœªé…ç½® GitHub Actions (`.github/workflows/` ä¸ºç©º)

**è®¡åˆ’ä¸­çš„ CI/CD**:
- `.github/ISSUE_TEMPLATE/ccai-implementation.md` åŒ…å«è¯¦ç»†çš„ GitHub Actions + Claude Code è‡ªåŠ¨åŒ–ç³»ç»Ÿå®æ–½è®¡åˆ’
- ç›®æ ‡: é€šè¿‡ `@ccai` å‘½ä»¤è§¦å‘ Claude Code è‡ªåŠ¨ç¼–ç¨‹

### åˆ†æ”¯ç­–ç•¥ (è®¡åˆ’ä¸­)
æ ¹æ® ccai-implementation.md:
- **Issue åˆ†æ”¯**: `issue_xxx` (è‡ªåŠ¨åˆ›å»º/åˆ‡æ¢)
- **å¹¶å‘æ§åˆ¶**: åŒä¸€ issue æ’é˜Ÿæ‰§è¡Œ

### ç¯å¢ƒç®¡ç†å·¥ä½œæµ

#### æ–‡ä»¶ç»“æ„
```
.env.example              â† æ¨¡æ¿ (å·²æäº¤)
.env.development          â† å¼€å‘é»˜è®¤å€¼ (å·²æäº¤, æ— æ•æ„Ÿä¿¡æ¯)
.env.development.local    â† æœ¬åœ°è¦†ç›– (å·²å¿½ç•¥, åŒ…å«çœŸå®å‡­æ®)
.env.production           â† ç”Ÿäº§æ¨¡æ¿ (å·²æäº¤, å ä½ç¬¦)
.env.production.local     â† çœŸå®ç”Ÿäº§å€¼ (å·²å¿½ç•¥, ä½¿ç”¨éƒ¨ç½²å¹³å°)
.env.test                 â† å•å…ƒæµ‹è¯• (å·²æäº¤)
.env.e2e                  â† E2E æµ‹è¯• (å·²æäº¤)
```

#### åŠ è½½ä¼˜å…ˆçº§ (ä»é«˜åˆ°ä½)
1. ç³»ç»Ÿç¯å¢ƒå˜é‡ (éƒ¨ç½²å¹³å°æ³¨å…¥)
2. `.env.{NODE_ENV}.local` (æœ¬åœ°è¦†ç›–)
3. `.env.{NODE_ENV}` (ç¯å¢ƒé»˜è®¤å€¼)

**é‡è¦**:
- âŒ **ä¸ä½¿ç”¨** `.env` æ–‡ä»¶ (å¦‚å­˜åœ¨ä¼šè­¦å‘Š)
- âœ… ä½¿ç”¨ `npm run env:setup` åˆå§‹åŒ–ç¯å¢ƒ
- âœ… ä½¿ç”¨ `npm run env:validate` éªŒè¯é…ç½®

### DX CLI å·¥ä½œæµ
**ç»Ÿä¸€å‘½ä»¤æ¥å£** - `./scripts/dx` (æˆ– `npm run dx`)

#### æ ¸å¿ƒå‘½ä»¤
```bash
# å¯åŠ¨æœåŠ¡
./scripts/dx start dev          # å¼€å‘æ¨¡å¼
./scripts/dx start debug        # è°ƒè¯•æ¨¡å¼
./scripts/dx start prod         # ç”Ÿäº§æ¨¡å¼

# æ„å»º
./scripts/dx build --dev        # å¼€å‘æ„å»º
./scripts/dx build --prod       # ç”Ÿäº§æ„å»º

# æ•°æ®åº“
./scripts/dx db generate        # ç”Ÿæˆ Prisma Client
./scripts/dx db migrate --dev   # è¿è¡Œè¿ç§»
./scripts/dx db reset --dev -Y  # é‡ç½®æ•°æ®åº“ (è·³è¿‡ç¡®è®¤)
./scripts/dx db studio          # Prisma Studio GUI

# æµ‹è¯•
./scripts/dx test unit          # å•å…ƒæµ‹è¯•
./scripts/dx test e2e           # E2E æµ‹è¯•
./scripts/dx test cov           # è¦†ç›–ç‡æŠ¥å‘Š

# ä»£ç è´¨é‡
./scripts/dx lint               # ä»£ç æ£€æŸ¥
./scripts/dx format             # ä»£ç æ ¼å¼åŒ–

# ç¯å¢ƒç®¡ç†
./scripts/dx env setup --dev    # è®¾ç½®å¼€å‘ç¯å¢ƒ
./scripts/dx env validate       # éªŒè¯ç¯å¢ƒå˜é‡

# æ¸…ç†
./scripts/dx clean dist         # æ¸…ç†æ„å»ºäº§ç‰©
./scripts/dx clean deps         # é‡è£…ä¾èµ–
./scripts/dx clean all -Y       # æ¸…ç†æ‰€æœ‰
```

#### DX CLI ç‰¹æ€§
- ğŸ¯ ç»Ÿä¸€æ¥å£ç®¡ç†æ‰€æœ‰æ“ä½œ
- ğŸŒ æ™ºèƒ½ç¯å¢ƒç®¡ç† (é€šè¿‡ `--dev/--prod/--test/--e2e` æ ‡å¿—)
- ğŸ”’ å±é™©æ“ä½œè‡ªåŠ¨ç¡®è®¤ (å¯é€šè¿‡ `-Y` æˆ– `CI=true` è·³è¿‡)
- ğŸš€ ç«¯å£å†²çªè‡ªåŠ¨æ£€æµ‹
- ğŸ“ è¯¦ç»†çš„é”™è¯¯ä¿¡æ¯å’Œå»ºè®®

---

## ğŸ§ª æµ‹è¯•ç­–ç•¥

### æµ‹è¯•æ¡†æ¶
- **å•å…ƒæµ‹è¯•**: Jest
- **E2E æµ‹è¯•**: Jest + Supertest
- **è¦†ç›–ç‡**: Jest Coverage

### æµ‹è¯•é…ç½®
**å•å…ƒæµ‹è¯•** (`package.json:jest`):
```json
{
  "rootDir": "src",
  "testRegex": ".*\\.spec\\.ts$",
  "testEnvironment": "node"
}
```

**E2E æµ‹è¯•** (`e2e/jest-e2e.json`):
```json
{
  "rootDir": ".",
  "testRegex": ".e2e-spec.ts$",
  "testEnvironment": "node",
  "moduleNameMapper": {
    "^@/(.*)$": "<rootDir>/../src/$1"
  }
}
```

### ç°æœ‰æµ‹è¯•
- `e2e/config.e2e-spec.ts` - é…ç½®åŠ è½½æµ‹è¯•
- `e2e/database.e2e-spec.ts` - æ•°æ®åº“è¿æ¥æµ‹è¯•
- `e2e/redis.e2e-spec.ts` - Redis è¿æ¥æµ‹è¯•

### æµ‹è¯•æ•°æ®åº“ç­–ç•¥
- ä½¿ç”¨å•ç‹¬çš„ `REDIS_DB` ç¼–å·éš”ç¦»æµ‹è¯•æ•°æ®
  - å¼€å‘ç¯å¢ƒ: DB 0
  - å•å…ƒæµ‹è¯•: DB 1
  - E2E æµ‹è¯•: DB 2

---

## ğŸ”Œ é›†æˆç‚¹å’Œæ‰©å±•èƒ½åŠ›

### æ•°æ®åº“é›†æˆ
- **ORM**: Prisma (æ”¯æŒ PostgreSQL, MySQL, SQLite ç­‰)
- **è¿ç§»**: `prisma migrate` (ç‰ˆæœ¬åŒ–è¿ç§»)
- **Schema**: `prisma/schema.prisma` (å£°æ˜å¼æ•°æ®æ¨¡å‹)

### ç¼“å­˜é›†æˆ
- **Redis å®¢æˆ·ç«¯**: `redis` åŒ… (v4)
- **ç¼“å­˜ç®¡ç†å™¨**: `cache-manager` + `cache-manager-redis-yet`
- **å…¨å±€è®¿é—®**: `RedisService` (å…¨å±€æ¨¡å—)

### API æ–‡æ¡£é›†æˆ
- **Swagger**: è‡ªåŠ¨ç”Ÿæˆ OpenAPI 3.0 è§„èŒƒ
- **è®¿é—®**: `http://localhost:3000/api`
- **è®¤è¯**: Bearer Auth (å·²é…ç½®è£…é¥°å™¨)

### ç¯å¢ƒé…ç½®é›†æˆ
- **ConfigService**: ç±»å‹å®‰å…¨çš„é…ç½®è®¿é—®
- **éªŒè¯**: å¯åŠ¨æ—¶éªŒè¯å¿…éœ€å˜é‡ (`DATABASE_URL`, `REDIS_HOST`, `REDIS_PORT`)
- **ç¯å¢ƒæ„ŸçŸ¥**: é€šè¿‡ `NODE_ENV` è‡ªåŠ¨åŠ è½½å¯¹åº”é…ç½®æ–‡ä»¶

### æ¨èçš„æ‰©å±•æ–¹å‘
æ ¹æ® README.md å»ºè®®:
- èº«ä»½è®¤è¯ (JWT, Passport)
- æƒé™æ§åˆ¶ (Guards)
- æ—¥å¿—ç³»ç»Ÿ (Winston)
- æ¶ˆæ¯é˜Ÿåˆ— (Bull, RabbitMQ)
- æ–‡ä»¶ä¸Šä¼ 
- GraphQL API

---

## âš ï¸ æ½œåœ¨çº¦æŸå’Œè€ƒè™‘å› ç´ 

### æŠ€æœ¯çº¦æŸ
1. **TypeScript ä¸¥æ ¼æ€§**: éƒ¨åˆ†ä¸¥æ ¼æ£€æŸ¥å·²ç¦ç”¨ (`strictNullChecks`, `noImplicitAny`)
   - å¯èƒ½å¯¼è‡´è¿è¡Œæ—¶ç±»å‹é”™è¯¯
   - å»ºè®®åç»­é€æ­¥å¯ç”¨
2. **ESLint é…ç½®ç¼ºå¤±**: ä»£ç æ£€æŸ¥è§„åˆ™å·²ç§»é™¤
   - ä¾èµ–ä»ä¿ç•™,ä½†æ— é…ç½®æ–‡ä»¶
   - ä»…ä¾èµ– Prettier è¿›è¡Œæ ¼å¼åŒ–
3. **ES Modules**: é¡¹ç›®ä½¿ç”¨ ESM (`"type": "module"`)
   - éƒ¨åˆ†å·¥å…·å¯èƒ½éœ€è¦é¢å¤–é…ç½®
   - æ„å»ºäº§ç‰©ä»ä¸º CommonJS

### ç¯å¢ƒçº¦æŸ
1. **å¿…éœ€å¤–éƒ¨ä¾èµ–**:
   - PostgreSQL æ•°æ®åº“å®ä¾‹
   - Redis æœåŠ¡å™¨å®ä¾‹
2. **ç¯å¢ƒå˜é‡ç®¡ç†**:
   - âŒ ç¦æ­¢ä½¿ç”¨ `.env` æ–‡ä»¶
   - âœ… å¿…é¡»ä½¿ç”¨ `.env.{NODE_ENV}.local`
   - å¯åŠ¨å‰å¿…é¡»è¿è¡Œ `npm run env:setup`

### æ€§èƒ½çº¦æŸ
1. **ç¼“å­˜ TTL**: å›ºå®šä¸º 5 åˆ†é’Ÿ
   - å¯èƒ½ä¸é€‚åˆæ‰€æœ‰åœºæ™¯
   - å»ºè®®é…ç½®åŒ–
2. **å…¨å±€éªŒè¯ç®¡é“**: æ‰€æœ‰è¯·æ±‚éƒ½ç»è¿‡éªŒè¯
   - å¯èƒ½å½±å“é«˜å¹¶å‘åœºæ™¯
   - è€ƒè™‘ä¸ºç‰¹å®šè·¯ç”±ç¦ç”¨

### å®‰å…¨çº¦æŸ
1. **å¯†ç å­˜å‚¨**: å½“å‰æœªåŠ å¯†
   - ç¤ºä¾‹ä»£ç ä¸­å¯†ç æ˜æ–‡å­˜å‚¨
   - âš ï¸ **å¿…é¡»å®ç°**: bcrypt/argon2 å“ˆå¸Œ
2. **CORS**: é»˜è®¤å…è®¸æ‰€æœ‰æº (`app.enableCors()`)
   - ç”Ÿäº§ç¯å¢ƒåº”é™åˆ¶ `CORS_ORIGIN`
3. **Swagger**: ç”Ÿäº§ç¯å¢ƒæš´éœ² API æ–‡æ¡£
   - å»ºè®®ä»…åœ¨å¼€å‘ç¯å¢ƒå¯ç”¨

### æ‰©å±•æ€§çº¦æŸ
1. **å•ä½“æ¶æ„**: éå¾®æœåŠ¡æ¶æ„
   - é€‚åˆä¸­å°å‹é¡¹ç›®
   - å¤§è§„æ¨¡åœºæ™¯éœ€é‡æ„
2. **åŒæ­¥ç¼“å­˜å¤±æ•ˆ**: æ‰‹åŠ¨åˆ é™¤ç¼“å­˜
   - æ˜“å‡ºé”™
   - å»ºè®®å®ç°è£…é¥°å™¨æˆ–æ‹¦æˆªå™¨è‡ªåŠ¨åŒ–

---

## ğŸš€ æ–°åŠŸèƒ½é›†æˆå»ºè®®

### æ·»åŠ æ–°æ¨¡å—
éµå¾ªç°æœ‰ `users` æ¨¡å—ç»“æ„:

```bash
# 1. åˆ›å»ºç›®å½•ç»“æ„
mkdir -p src/modules/<feature>/dto
touch src/modules/<feature>/<feature>.controller.ts
touch src/modules/<feature>/<feature>.service.ts
touch src/modules/<feature>/<feature>.module.ts

# 2. å®šä¹‰ DTO (ä½¿ç”¨ class-validator)
# 3. å®ç° Service (æ³¨å…¥ PrismaService å’Œ RedisService)
# 4. å®ç° Controller (æ·»åŠ  Swagger è£…é¥°å™¨)
# 5. åœ¨ app.module.ts ä¸­å¯¼å…¥æ¨¡å—
```

### æ•°æ®åº“å˜æ›´
```bash
# 1. ä¿®æ”¹ prisma/schema.prisma
# 2. ç”Ÿæˆè¿ç§»
./scripts/dx db migrate --dev
# 3. ç”Ÿæˆ Prisma Client
./scripts/dx db generate
# 4. é‡æ–°æ„å»º (å¦‚éœ€ç±»å‹æ›´æ–°)
./scripts/dx build
```

### æ·»åŠ ç¯å¢ƒå˜é‡
```bash
# 1. æ›´æ–° .env.example
# 2. æ›´æ–° src/config/configuration.ts
# 3. æ›´æ–° .env.{NODE_ENV} æ–‡ä»¶
# 4. éªŒè¯é…ç½®
./scripts/dx env validate
```

### é›†æˆè®¤è¯ (JWT)
æ¨èæ­¥éª¤:
1. å®‰è£…ä¾èµ–: `@nestjs/jwt`, `@nestjs/passport`, `passport-jwt`, `bcrypt`
2. åˆ›å»º `auth` æ¨¡å— (å‚è€ƒ users æ¨¡å—ç»“æ„)
3. å®ç° JWT ç­–ç•¥å’Œ Guard
4. åœ¨ `configuration.ts` ä¸­å·²é¢„ç•™ `jwt` é…ç½®
5. æ›´æ–° Swagger é…ç½® (å·²æ·»åŠ  `.addBearerAuth()`)

---

## ğŸ“Š é¡¹ç›®æˆç†Ÿåº¦è¯„ä¼°

### ä¼˜åŠ¿
âœ… ç°ä»£åŒ–æŠ€æœ¯æ ˆ (NestJS 10, Prisma 5, TypeScript 5)
âœ… å®Œå–„çš„æ–‡æ¡£ä½“ç³» (README, CLAUDE.md, ç¯å¢ƒå˜é‡æ–‡æ¡£)
âœ… ç»Ÿä¸€çš„ DX CLI å·¥å…· (å¼€å‘ä½“éªŒä¼˜åŒ–)
âœ… ç±»å‹å®‰å…¨çš„æ•°æ®åº“å’Œé…ç½®è®¿é—®
âœ… å…¨å±€æœåŠ¡æ¨¡å¼ (å‡å°‘é‡å¤ä»£ç )
âœ… å¤šç¯å¢ƒé…ç½®ç®¡ç† (å¼€å‘/æµ‹è¯•/ç”Ÿäº§éš”ç¦»)
âœ… E2E æµ‹è¯•è¦†ç›–å…³é”®æœåŠ¡
âœ… è‡ªåŠ¨ç”Ÿæˆçš„ API æ–‡æ¡£

### å¾…æ”¹è¿›
âš ï¸ ç¼ºå°‘ CI/CD é…ç½® (å·²è®¡åˆ’)
âš ï¸ å•å…ƒæµ‹è¯•è¦†ç›–ä¸è¶³ (ä»… E2E æµ‹è¯•)
âš ï¸ å¯†ç æœªåŠ å¯† (ç¤ºä¾‹ä»£ç å®‰å…¨é—®é¢˜)
âš ï¸ ESLint é…ç½®å·²ç§»é™¤ (ä»…ä¾èµ– Prettier)
âš ï¸ TypeScript ä¸¥æ ¼æ¨¡å¼éƒ¨åˆ†ç¦ç”¨
âš ï¸ ç¼ºå°‘è®¤è¯å’Œæˆæƒå®ç°
âš ï¸ ç¼ºå°‘æ—¥å¿—ç³»ç»Ÿé›†æˆ

### é€‚ç”¨åœºæ™¯
- âœ… ä¸­å°å‹åç«¯ API é¡¹ç›®
- âœ… éœ€è¦å¿«é€ŸåŸå‹éªŒè¯
- âœ… å­¦ä¹  NestJS æœ€ä½³å®è·µ
- âš ï¸ å¤§è§„æ¨¡å¾®æœåŠ¡æ¶æ„ (éœ€é‡æ„)
- âš ï¸ é«˜å®‰å…¨æ€§è¦æ±‚ (éœ€å¢å¼ºå®‰å…¨ç‰¹æ€§)

---

## ğŸ¯ å…³é”®å†³ç­–å’Œè®¾è®¡å“²å­¦

### ç¯å¢ƒç®¡ç†å“²å­¦
**åˆ†å±‚åŠ è½½ + æ˜ç¡®åˆ†ç¦»**
- æäº¤çš„æ–‡ä»¶: é»˜è®¤å€¼å’Œæ¨¡æ¿ (æ— æ•æ„Ÿä¿¡æ¯)
- æœ¬åœ°æ–‡ä»¶: çœŸå®å‡­æ® (gitignored)
- ç”Ÿäº§ç¯å¢ƒ: éƒ¨ç½²å¹³å°æ³¨å…¥ (ä¸ä¾èµ–æ–‡ä»¶)

### æ¨¡å—åŒ–å“²å­¦
**å…¨å±€æœåŠ¡ + ä¸šåŠ¡æ¨¡å—éš”ç¦»**
- åŸºç¡€è®¾æ–½æœåŠ¡ (Prisma, Redis) å…¨å±€å¯ç”¨
- ä¸šåŠ¡æ¨¡å—ç‹¬ç«‹,æŒ‰åŠŸèƒ½ç»„ç»‡
- éµå¾ª SOLID åŸåˆ™

### å¼€å‘ä½“éªŒå“²å­¦
**ç»Ÿä¸€å·¥å…·é“¾ + è‡ªåŠ¨åŒ–**
- DX CLI ç»Ÿä¸€æ‰€æœ‰æ“ä½œ
- è‡ªåŠ¨ç¯å¢ƒæ£€æµ‹å’ŒéªŒè¯
- å±é™©æ“ä½œå¼ºåˆ¶ç¡®è®¤

### æ–‡æ¡£å“²å­¦
**ä»£ç å³æ–‡æ¡£ + è¡¥å……è¯´æ˜**
- Swagger è£…é¥°å™¨é©±åŠ¨ API æ–‡æ¡£
- CLAUDE.md æä¾›æ¶æ„æŒ‡å—
- è¯¦ç»†çš„ç¯å¢ƒå˜é‡æ–‡æ¡£

---

## ğŸ“– å‚è€ƒèµ„æº

### å®˜æ–¹æ–‡æ¡£
- [NestJS æ–‡æ¡£](https://docs.nestjs.com/)
- [Prisma æ–‡æ¡£](https://www.prisma.io/docs)
- [Redis æ–‡æ¡£](https://redis.io/docs)

### é¡¹ç›®æ–‡æ¡£
- `/README.md` - é¡¹ç›®æ¦‚è§ˆ
- `/CLAUDE.md` - Claude Code æŒ‡å—
- `/doc/env-structure-design.md` - ç¯å¢ƒå˜é‡è®¾è®¡
- `/scripts/README.md` - DX CLI å®Œæ•´æ–‡æ¡£
- `/scripts/QUICKSTART.md` - DX CLI å¿«é€Ÿå…¥é—¨

### è®¡åˆ’ä¸­çš„åŠŸèƒ½
- `.github/ISSUE_TEMPLATE/ccai-implementation.md` - GitHub Actions + Claude Code è‡ªåŠ¨åŒ–ç³»ç»Ÿ

---

## ğŸ“Œ æ€»ç»“

### é¡¹ç›®å®šä½
**ç”Ÿäº§å°±ç»ªçš„ NestJS åç«¯è„šæ‰‹æ¶** - é›†æˆç°ä»£å·¥å…·é“¾å’Œæœ€ä½³å®è·µ,é€‚åˆå¿«é€Ÿå¯åŠ¨ä¸­å°å‹ API é¡¹ç›®ã€‚

### æŠ€æœ¯äº®ç‚¹
1. **ç±»å‹å®‰å…¨**: TypeScript + Prisma å…¨æ ˆç±»å‹æ¨å¯¼
2. **å¼€å‘ä½“éªŒ**: ç»Ÿä¸€çš„ DX CLI + å¤šç¯å¢ƒç®¡ç†
3. **æ¶æ„æ¸…æ™°**: æ¨¡å—åŒ– + å…¨å±€æœåŠ¡ + ç¼“å­˜ç­–ç•¥
4. **æ–‡æ¡£å®Œå–„**: Swagger + è¯¦ç»†æŒ‡å— + è®¾è®¡æ–‡æ¡£

### é›†æˆæ–°åŠŸèƒ½å»ºè®®
- éµå¾ªç°æœ‰æ¨¡å—ç»“æ„ (`modules/<feature>/`)
- ä½¿ç”¨ DX CLI ç®¡ç†æ‰€æœ‰æ“ä½œ
- æ·»åŠ  Swagger è£…é¥°å™¨
- æ›´æ–°ç›¸å…³æ–‡æ¡£

### æ³¨æ„äº‹é¡¹
- âš ï¸ å¿…é¡»å®‰è£… PostgreSQL å’Œ Redis
- âš ï¸ å¿…é¡»è¿è¡Œ `./scripts/dx env setup --dev` åˆå§‹åŒ–ç¯å¢ƒ
- âš ï¸ ç¤ºä¾‹ä»£ç æœªåŠ å¯†å¯†ç ,ç”Ÿäº§ç¯å¢ƒéœ€å®ç°
- âš ï¸ CORS é»˜è®¤å¼€æ”¾,ç”Ÿäº§ç¯å¢ƒéœ€é™åˆ¶

---

**æŠ¥å‘Šç”Ÿæˆæ—¶é—´**: 2025-10-25
**åˆ†æå·¥å…·**: Claude Code
**ä»“åº“è·¯å¾„**: `/Users/a1/work/aiaction`
**Git çŠ¶æ€**: æ¸…æ´å·¥ä½œåŒº (æ— æœªæäº¤æ›´æ”¹)
