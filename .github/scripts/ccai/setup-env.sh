#!/bin/bash
# ==========================================
# çŽ¯å¢ƒé…ç½®æ–‡ä»¶ç”Ÿæˆè„šæœ¬
# åŠŸèƒ½: åˆ›å»º .env.development.local
# è¾“å…¥: $1 = ANTHROPIC_API_KEY
# è¾“å‡º: .env.development.local æ–‡ä»¶
# ==========================================

set -euo pipefail

ANTHROPIC_API_KEY="$1"

# éªŒè¯å‚æ•°
if [ -z "$ANTHROPIC_API_KEY" ]; then
  echo "âŒ Error: ANTHROPIC_API_KEY is required"
  exit 1
fi

echo "ðŸ“ Creating environment configuration file..."

# åˆ›å»ºçŽ¯å¢ƒæ–‡ä»¶
cat > .env.development.local << EOF
# ==========================================
# CI Environment Configuration
# Auto-generated by GitHub Actions
# ==========================================

# Application
NODE_ENV=development
PORT=3000

# Database (Service Container)
DATABASE_URL="postgresql://test_user:test_password@localhost:5432/nestjs_ci_test?schema=public"

# Redis (Service Container)
REDIS_HOST=localhost
REDIS_PORT=6379
REDIS_PASSWORD=
REDIS_DB=0

# Logging
LOG_LEVEL=debug

# Anthropic API Key (from GitHub Secrets)
ANTHROPIC_API_KEY=${ANTHROPIC_API_KEY}
EOF

echo "âœ… Environment file created: .env.development.local"

# æ˜¾ç¤ºå†…å®¹ (éšè—æ•æ„Ÿä¿¡æ¯)
echo "ðŸ“„ File contents (API key hidden):"
cat .env.development.local | grep -v "ANTHROPIC_API_KEY"
echo "ANTHROPIC_API_KEY=***REDACTED***"
